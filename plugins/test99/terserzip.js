// Klo mau pake, pake aja ini bkn enc cma terser aja

import{minify}from"terser";import AdmZip from"adm-zip";const handler=async(m,{conn:conn})=>{if(!m.quoted)return conn.reply(m.chat,"Mohon kutip file ZIP yang akan diompresi.",m);if("application/zip"!==m.quoted.mimetype)return conn.reply(m.chat,"Kutipan harus berupa file ZIP.",m);const zipPath=await conn.downloadAndSaveMediaMessage(m.quoted),outputZip=new AdmZip,failedFiles=[],failedReasons={};try{const zipEntries=new AdmZip(zipPath).getEntries();for(const entry of zipEntries)if(entry.entryName.endsWith(".js")){const inputCode=entry.getData().toString("utf8"),options={mangle:!1,compress:!0};try{const result=await minify(inputCode,options);result.error?(failedFiles.push(entry.entryName),failedReasons[entry.entryName]=result.error):outputZip.addFile(entry.entryName,Buffer.from(result.code,"utf8"))}catch(minifyError){failedFiles.push(entry.entryName),failedReasons[entry.entryName]=minifyError}}if(failedFiles.length>0){let failedList="Daftar file yang gagal dikompresi:\n";for(const file of failedFiles)failedList+=`${file}: ${failedReasons[file]}\n`;conn.reply(m.chat,failedList,m)}outputZip.getEntries().length>0&&conn.sendFile(m.chat,outputZip.toBuffer(),"compressed.zip","Berikut adalah file ZIP yang berisi JavaScript yang telah dikompresi.")}catch(error){console.log("Terjadi kesalahan dalam mengelola file ZIP:",error),conn.reply(m.chat,"Terjadi kesalahan dalam mengompresi atau mengelola file ZIP.",m)}};handler.command=/^compresszip$/i;export default handler;