import fetch from"node-fetch";import{FormData,Blob}from"formdata-node";import{fileTypeFromBuffer}from"file-type";import cheerio from"cheerio";let handler=async(m,{conn:conn,text:text,args:args,usedPrefix:usedPrefix,command:command})=>{try{let q=m.quoted?m.quoted:m;if(!(q.msg||q).mimetype)throw"No media found";let media=await q.download();await m.reply(wait);let linkPom=await top4top(media),{upBoxTitle:upBoxTitle,imgSrc:imgSrc,imgURL:imgURL,imgBBC:imgBBC,imgHTML:imgHTML,delCode:delCode}=linkPom,caption=`${upBoxTitle}\n📮 *L I N K:*\n${imgURL||imgSrc}\n\n*Del Code*\n${delCode}\n📊 *S I Z E :* ${media.length} Byte\n`;await conn.reply(m.chat,caption,m)}catch(error){console.error(error),await m.reply("Terjadi kesalahan dalam pemrosesan permintaan Anda. 🙁")}};handler.help=["top4top"],handler.tags=["tools"],handler.command=/^(top4top)$/i;export default handler;const top4top=async buffer=>{try{const{ext:ext,mime:mime}=await fileTypeFromBuffer(buffer)||{};let form=new FormData;const blob=new Blob([buffer.toArrayBuffer()],{type:mime});form.append("file_1_",blob,"tmp."+ext),form.append("submitr","[ رفع الملفات ]");let res=await fetch("https://www.top4top.me/#uploader",{method:"POST",body:form});const html=await res.text(),$=cheerio.load(html);return $(".list-group-item").map(((index,element)=>({upBoxTitle:$(element).find(".up-box-title").text().trim(),imgSrc:$(element).find("img").attr("src"),imgURL:$(element).find("#image1").val(),imgBBC:$(element).find("#imageBBC").val(),imgHTML:$(element).find("#imageHTML").val(),delCode:$(element).find("#imagedelCode").val()}))).get()[0]}catch(error){throw console.error(error),error}};function formatBytes(bytes){if(0===bytes)return"0 B";const i=Math.floor(Math.log(bytes)/Math.log(1024));return`${(bytes/1024**i).toFixed(2)} ${["B","KB","MB","GB","TB"][i]}`}